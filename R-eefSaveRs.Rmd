---
title: "Coral Reef Health and Organismal Occurrence Analysis Project"
author: "Jonah Kotzen, Elisabeth Laviolette, Lauren Geary, Elizabeth Breitmeyer & Katie Miller"
date: "2023-12-06"
output: html_document
bibliography: BIOL3140.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rgbif)
library(tidyverse)
library(MuMIn)
library(rnoaa)
library(data.table)
library(ggmap)
library(usmap)
library(sf)
library(magick)
library(cowplot)
library(lme4)
library(car)
```

## Introduction
[Provide a brief overview of the project, its objectives, and its significance]

## Objectives
- Objective 1: [Detail the primary objective of your project]
- Objective 2: [Detail the secondary objective of your project, if any]

## Methodology
Briefly describe the methodology used in this project, including data sources and analysis techniques.

### Data Sources
- Coral Reef Health Data: [Describe the source and nature of the coral reef health data]
- Fish Occurrence Data: Using the `rgbif` package to access data from GBIF.

### Data Retrieval and Processing
#### Using `rgbif` for Fish Occurrence Data
```{r querying GBIFs API, echo=FALSE, cache = TRUE}
species <- c("Triaenodon obesus", "Tridacna gigas", "Chaetodon rainfordi", "Abudefduf vaigiensis","Chlorurus sordidus")
year <- paste0("2000",",","2017")

data.l <- list() #making empty list to store data
```


```{r coral bleaching data, echo=FALSE, cache = TRUE}
bleachingdata <- read_csv("bleachingdatabase.csv")
head(bleachingdata)
```

```{r modbleach, include=TRUE}
filtered_data <- bleachingdata %>%
  select(LATITUDE, LONGITUDE, YEAR, SEVERITY_CODE, LOCATION) %>%
  filter(complete.cases(.))
```

```{r reef stuff, include=TRUE}

# Define the latitude and longitude boundaries of the Great Barrier Reef
lat_min <- -24   # Southernmost latitude
lat_max <- -11   # Northernmost latitude
long_min <- 142  # Westernmost longitude
long_max <- 154  # Easternmost longitude

# Add the within_reef column
filtered_data <- filtered_data %>%
  mutate(within_reef = LATITUDE >= lat_min & LATITUDE <= lat_max & 
                        LONGITUDE >= long_min & LONGITUDE <= long_max)


# Group by the within_reef column and count the number of TRUE and FALSE values
reef_count <- filtered_data %>%
  group_by(within_reef) %>%
  summarise(count = n())

# The reef_count tibble now contains the count of TRUE and FALSE values in the within_reef column.

reef_data <- filtered_data %>%
  filter(within_reef == TRUE)

```

```{r zone grouping, include=TRUE}
# Determine new latitude boundaries for each zone based on quantiles
zone_boundary_1 <- quantile(reef_data$LATITUDE, probs = 1/3)
zone_boundary_2 <- quantile(reef_data$LATITUDE, probs = 2/3)

# Re-assign the reef_zone column
reef_data <- reef_data %>%
  mutate(reef_zone = case_when(
    LATITUDE <= zone_boundary_1 ~ "A",
    LATITUDE > zone_boundary_1 & LATITUDE <= zone_boundary_2 ~ "B",
    TRUE ~ "C"
  ))

# Check the new distribution
new_zone_counts <- reef_data %>%
  count(reef_zone)

```


```{r visualizing, include=TRUE}
library(ggplot2)
library(dplyr)
library(leaflet)

# Create a leaflet map and add tiles
reef_map <- leaflet() %>% 
  addTiles() %>%  # This adds the default OpenStreetMap tiles
  setView(lng = mean(c(142, 154)), lat = mean(c(-24, -10)), zoom = 6)

# Add points to the map
reef_map <- reef_map %>% 
  addCircleMarkers(data = reef_data, 
                   ~LONGITUDE, 
                   ~LATITUDE, 
                   color = ~case_when(reef_zone == "A" ~ "red",
                                      reef_zone == "B" ~ "blue",
                                      reef_zone == "C" ~ "green"),
                   popup = ~paste("Zone:", reef_zone))

# Print the map
reef_map

```



##Results

##Discussion

##Author Contributions

##References
